# 全时间周期回测分析报告

**生成时间**: 2025-11-20  
**分析范围**: 6标的 × 6时间周期 = 36组合  
**策略**: EMA(20/50)交叉 + Regime过滤与仓位管理

---

## 📊 执行总结

### 回测完成情况

✅ **100%完成** - 所有36个symbol×timeframe组合回测成功  
✅ **217个结果文件**生成（36组合 × 6文件类型 + 1对比文件）  
✅ **0失败** - 无错误或异常

### 数据规模

| 指标 | 数值 |
|------|------|
| 总K线数 | ~5,000,000+ |
| 总交易数 | 103,000+ |
| 最大单组合K线数 | 1,097,494 (XAGUSD 5min) |
| 最大单组合交易数 | 11,822 (USDJPY 5min) |
| 最小单组合交易数 | 20 (ETHUSD 1d) |

---

## 🎯 关键发现

### 1. **Regime过滤效果：0%阻挡率**

**重要发现**: 在所有36个组合中，gating规则**阻挡了0笔交易**（0.0%）

**原因分析**:
- 当前阈值设置过于保守：
  - `high_riskscore: 0.8` (需要RiskScore > 0.8才阻挡)
  - `triple_high_box: "M_high_O_high_V_high"` (需要三个因子同时高)
- 实际市场中，同时满足这两个极端条件的情况极少

**影响**:
- Regime-aware策略 = Baseline策略（仅仓位管理有差异）
- 无法验证gating的有效性
- 需要重新校准阈值

### 2. **仓位管理效果：降低收益但改善风险**

由于gating未生效，唯一的regime效应来自动态仓位管理：

| 风险Regime | 仓位比例 | 效果 |
|-----------|---------|------|
| Low | 100% | 全仓 |
| Medium | 70% | 减仓 |
| High | 30% | 大幅减仓 |

**观察到的模式**:
- **收益降低**: Regime策略收益普遍低于Baseline（因为减仓）
- **风险降低**: 最大回撤普遍改善
- **Sharpe不变**: 由于收益和风险同比例降低

---

## 📈 分标的分析

### **BTCUSD - 最佳表现**

| 时间周期 | Baseline收益 | Regime收益 | Baseline Sharpe | 交易数 |
|---------|-------------|-----------|----------------|--------|
| 5min | 6.55% | 3.10% | 0.042 | 7,957 |
| 15min | 8.08% | 5.48% | 0.087 | 2,466 |
| 30min | **10.05%** | 6.20% | 0.121 | 1,213 |
| 1h | 8.46% | 4.87% | 0.155 | 587 |
| 4h | 8.90% | 5.78% | 0.246 | 144 |
| 1d | **10.34%** | 7.37% | **0.364** | 22 |

**关键洞察**:
- ✅ 所有时间周期均盈利
- ✅ Sharpe随时间周期增加而提升（0.042 → 0.364）
- ✅ 30min和1d表现最佳（>10%收益）
- ⚠️ 5min交易频繁但Sharpe最低

### **ETHUSD - 微盈利**

| 时间周期 | Baseline收益 | Regime收益 | Baseline Sharpe | 交易数 |
|---------|-------------|-----------|----------------|--------|
| 5min | 0.46% | 0.19% | 0.048 | 7,415 |
| 15min | 0.70% | 0.42% | 0.079 | 2,373 |
| 30min | 0.46% | 0.33% | 0.100 | 1,154 |
| 1h | 0.53% | 0.25% | 0.162 | 537 |
| 4h | 0.31% | 0.33% | 0.210 | 140 |
| 1d | 0.30% | 0.21% | **0.301** | 20 |

**关键洞察**:
- ⚠️ 收益极低（<1%）
- ✅ Sharpe随时间周期提升
- 🤔 4h是唯一Regime优于Baseline的周期

### **EURUSD - 零收益**

| 时间周期 | Baseline收益 | Regime收益 | Baseline Sharpe | 交易数 |
|---------|-------------|-----------|----------------|--------|
| 5min | -0.00% | -0.00% | -0.020 | 11,473 |
| 15min | -0.00% | -0.00% | -0.015 | 3,614 |
| 30min | -0.00% | -0.00% | -0.006 | 1,777 |
| 1h | -0.00% | -0.00% | -0.025 | 900 |
| 4h | -0.00% | -0.00% | -0.042 | 253 |
| 1d | -0.00% | -0.00% | **-0.164** | 52 |

**关键洞察**:
- ❌ EMA策略完全不适用于EURUSD
- ❌ 所有时间周期Sharpe为负
- ⚠️ 交易数最多（5min: 11,473笔）但无效

### **USDJPY - 零收益但正Sharpe**

| 时间周期 | Baseline收益 | Regime收益 | Baseline Sharpe | 交易数 |
|---------|-------------|-----------|----------------|--------|
| 5min | 0.00% | 0.00% | 0.020 | 11,822 |
| 15min | 0.00% | 0.00% | 0.053 | 3,630 |
| 30min | 0.00% | 0.00% | 0.065 | 1,802 |
| 1h | 0.00% | 0.00% | 0.077 | 904 |
| 4h | 0.00% | 0.00% | 0.061 | 263 |
| 1d | 0.00% | 0.00% | **0.241** | 41 |

**关键洞察**:
- 🤔 收益为0但Sharpe为正（数值精度问题）
- ✅ Sharpe随时间周期提升
- ⚠️ 交易数最多（5min: 11,822笔）

### **XAGUSD - 微亏损**

| 时间周期 | Baseline收益 | Regime收益 | Baseline Sharpe | 交易数 |
|---------|-------------|-----------|----------------|--------|
| 5min | -0.07% | -0.04% | -0.024 | 11,483 |
| 15min | 0.02% | 0.01% | 0.016 | 3,683 |
| 30min | 0.03% | 0.02% | 0.034 | 1,817 |
| 1h | 0.03% | 0.02% | 0.047 | 855 |
| 4h | 0.03% | 0.03% | **0.099** | 241 |
| 1d | -0.01% | -0.01% | -0.015 | 51 |

**关键洞察**:
- ⚠️ 5min和1d亏损
- ✅ 中间周期微盈利
- ✅ 4h Sharpe最佳（0.099）

### **XAUUSD - 次佳表现**

| 时间周期 | Baseline收益 | Regime收益 | Baseline Sharpe | 交易数 |
|---------|-------------|-----------|----------------|--------|
| 5min | 1.37% | 0.94% | 0.016 | 11,208 |
| 15min | **2.50%** | 1.49% | 0.052 | 3,584 |
| 30min | **2.70%** | 1.90% | 0.080 | 1,776 |
| 1h | 2.29% | 1.34% | 0.097 | 884 |
| 4h | 0.93% | 0.72% | 0.126 | 240 |
| 1d | 0.80% | 0.66% | **0.213** | 46 |

**关键洞察**:
- ✅ 所有周期盈利
- ✅ 15min和30min表现最佳（>2.5%）
- ✅ Sharpe随时间周期提升

---

## 🔍 跨时间周期模式

### **1. Sharpe比率随时间周期提升**

**普遍规律**: 几乎所有标的都显示Sharpe随时间周期增加而提升

| 标的 | 5min Sharpe | 1d Sharpe | 提升倍数 |
|------|------------|-----------|---------|
| BTCUSD | 0.042 | 0.364 | **8.7x** |
| ETHUSD | 0.048 | 0.301 | **6.3x** |
| XAUUSD | 0.016 | 0.213 | **13.3x** |
| USDJPY | 0.020 | 0.241 | **12.1x** |

**原因**:
- 高频交易噪音更大
- 长周期趋势更稳定
- 交易成本影响（未计入）

### **2. 最佳时间周期**

| 标的 | 最佳周期（收益） | 最佳周期（Sharpe） |
|------|----------------|------------------|
| BTCUSD | 30min (10.05%) | 1d (0.364) |
| ETHUSD | 15min (0.70%) | 1d (0.301) |
| XAUUSD | 30min (2.70%) | 1d (0.213) |
| XAGUSD | 4h (0.03%) | 4h (0.099) |

**建议**: 对于趋势跟踪策略，**30min-1d**是最佳时间周期范围

---

## ⚠️ 当前问题与局限

### **1. Gating完全失效**
- 0%阻挡率意味着无法验证regime过滤的价值
- 需要重新校准阈值

### **2. 仓位管理降低收益**
- 虽然降低了风险，但也降低了收益
- Sharpe不变说明没有改善风险调整后收益

### **3. 未计入交易成本**
- 高频策略（5min）实际收益会大幅降低
- EURUSD和USDJPY可能在扣除成本后更差

### **4. 策略过于简单**
- EMA(20/50)对某些标的（EURUSD）完全无效
- 需要更复杂的入场逻辑

---

## 📁 文件结构

```
results/strategy_full/
├── compare_baseline_vs_regime.csv (1个)
├── trades_{symbol}_{timeframe}.csv (36个)
├── equity_{symbol}_{timeframe}.csv (36个)
├── summary_{symbol}_{timeframe}.csv (36个)
├── perf_by_risk_regime_{symbol}_{timeframe}.csv (36个)
├── perf_by_pressure_{symbol}_{timeframe}.csv (36个)
└── perf_by_box_{symbol}_{timeframe}.csv (36个)

总计: 217个文件
```

---

## 🚀 下一步建议

### **Phase 2A: 阈值校准**
1. 分析`perf_by_risk_regime`和`perf_by_box`文件
2. 找到真正的"高风险"regime定义
3. 重新设置gating阈值（建议从0.6开始）

### **Phase 2B: 策略优化**
1. 针对不同标的使用不同参数
2. 添加额外过滤条件（如ATR、成交量）
3. 考虑双向交易（做空）

### **Phase 2C: 成本分析**
1. 添加滑点和手续费模型
2. 重新评估高频策略可行性

### **Phase 2D: Regime深度分析**
1. 分析哪些regime真正盈利/亏损
2. 设计regime-specific策略
3. 研究regime持续性

---

**状态**: ✅ **COMPLETE**  
**耗时**: ~2小时（含回测执行）  
**成功率**: 100%

